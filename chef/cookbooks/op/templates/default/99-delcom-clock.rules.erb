# maintained by Chef
#
# udevadm info  -x   /sys/bus/usb/drivers/usbsevseg/1*
# sudo udevadm test --action=add /sys/bus/usb/drivers/usbsevseg/1*
# See systemctl --all --full -t device to see a list of all decives for which systemd has a unit in your system.
#
# udevadm info  -x --name  /dev/bus/usb/001/014
# sudo udevadm test $(udevadm info --query=path --name  /dev/bus/usb/001/014)
# sudo udevadm  monitor
# echo  1-1.3 | sudo tee /sys/bus/usb/drivers/usb/unbind
# echo  1-1.3 | sudo tee /sys/bus/usb/drivers/usb/bind
# journalctl -fp err

# This prints out rules that you can use to match the device in udev rules. 
# The first block is about the device itself, and the subsequent blocks are about its ancestors in the device tree.
# The only caveat is that you cannot mix keys that correspond to different ancestors.
# udevadm info  -a --name  /dev/bus/usb/001/014
# https://unix.stackexchange.com/questions/124817/udev-how-do-i-find-out-which-subsystem-a-device-belongs-to
# ACTION=="add", ATTR{product}=="USB Numeric Display", ATTR{manufacturer}=="Delcom Engineering", DRIVER=="usbsevseg", TAG+="systemd", ENV{SYSTEMD_WANTS}="<%= @unit %>@%k"

ACTION=="add", ENV{PRODUCT}=="<%= @product %>", DRIVER=="usbsevseg", TAG+="systemd"<%=
@alias ? ", ENV{SYSTEMD_ALIAS}=\"#{@alias}\"" : ""
%>, PROGRAM="/usr/bin/logger -p notice logger add delcom-clock name=$name k=%k n=%n p=%p b=%b driver=$driver N=%N"<%=
@wants ? ", ENV{SYSTEMD_WANTS}=\"#{@wants}\"" : "" %>

ACTION=="remove", ENV{PRODUCT}=="<%= @product %>", SUBSYSTEM=="usb", TAG+="systemd"<%=
@alias ? ", ENV{SYSTEMD_ALIAS}=\"#{@alias}\"" : ""
%>, PROGRAM="/usr/bin/logger -p notice logger remove delcom-clock name=$name k=%k n=%n p=%p b=%b driver=$driver N=%N"<%=
@wants ? ", ENV{SYSTEMD_WANTS}=\"#{@wants}\"" : "" %>
