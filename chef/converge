#!/bin/sh -e
chef=/usr/bin/chef-solo
[ -x $chef ] || sudo apt install chef
foodcritic=/usr/bin/foodcritic
[ -x $foodcritic ] || sudo apt install foodcritic
rubocop=/usr/bin/rubocop
[ -x $rubocop ] || sudo apt install rubocop
DIR=$(dirname $(readlink -f $0))
recipes=""
for i
do
	recipes="${recipes:+$recipes,}recipe[op::$i]"
done
sudo $chef --config $DIR/solo.rb --json-attributes $DIR/solo.json ${recipes:+-o $recipes}
if [ -z "$*" ]; then
	$foodcritic $DIR/cookbooks
	$rubocop --auto-correct $DIR
fi

# chef-shell --solo -z --config $PWD/solo.rb --json-attributes $PWD/solo.json
