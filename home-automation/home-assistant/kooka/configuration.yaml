homeassistant:
  name: kooka
  unit_system: metric
  time_zone: Europe/Paris
  latitude: 49.3812
  longitude: 2.3862
  elevation: 81

#lirc:
frontend:

mqtt:
  username: skldhf84d
  password: !secret mqtt
  client_id: kooka
  broker: stuartpi3

http:
  api_password: !secret http
  #server_host: 127.0.0.1
  trusted_networks:
    - 127.0.0.1

media_player:
  - platform: clementine
    name: clementine
    host: 127.0.0.1
    access_token: !secret clementine_token
  - platform: snapcast
    host: 127.0.0.1
  - platform: mpd
    host: 192.168.0.8
    password: !secret mpd_passwd

#mqtt_eventstream:
#  publish_topic: master/kooka
#  subscribe_topic: slaves/bedroom

mqtt_statestream:
  base_topic: salon

# https://home-assistant.io/cookbook/perform_actions_based_on_input_select/
input_select:
  radio_station:
    name: Radio Station
    options:
      - RFI Monde
      - France Culture
      - France Info
      - Ch√©rie FM
      - BBC World Service (AAC)
      - Public Radio International PRI 24 Hour Stream
      - Radio Tram
      - Radio 9090 90.9
      - Nogoum FM 100.6
      - 181.FM - Vocal Jazz
      - '#1 Jazz Radio'
      - '.977 Smooth Jazz'
      - None
    initial: None
    icon: mdi:radio

automation:
  - alias: play
    trigger:
      - platform: mqtt
        topic: bedroom/switch/delcom_clock/state
        # Optional
        payload: 'on'
    action:
      - service: media_player.media_play
        data:
          entity_id: media_player.clementine
      - service: media_player.media_play
        data:
          entity_id: media_player.mpd
  - alias: radio request
    trigger:
      - platform: mqtt
        topic: 'radio'
    action:
      - service: media_player.play_media
        data_template:
          entity_id: media_player.mpd
          media_content_type: playlist
          media_content_id: '{{ trigger.payload }}'
  - alias: message_RFI
    trigger:
      - platform: mqtt
        topic: 'message'
        payload: 'radio_RFI'
    action:
      - service: shell_command.radio_rfi
      - service: media_player.play_media
        data:
          entity_id: media_player.mpd
          media_content_type: playlist
          media_content_id: 'RFI Monde'
      - service: media_player.media_play
        data:
          entity_id: media_player.clementine
  - alias: message_leaving
    trigger:
      - platform: mqtt
        topic: 'message'
        payload: 'leaving'
    action:
      - service: media_player.media_pause
        data:
          entity_id: media_player.clementine
      - service: media_player.media_pause
        data:
          entity_id: media_player.mpd
  - alias: silence
    trigger:
      - platform: mqtt
        topic: bedroom/switch/delcom_clock/state
        # Optional
        payload: 'off'
    action:
      - service: media_player.media_pause
        data:
          entity_id: media_player.clementine
      - service: media_player.media_pause
        data:
          entity_id: media_player.mpd
  - alias: bedroom clock
    trigger:
      - platform: event
        event_type: bedroom.switch.delcom_clock.state
    action:
      service: media_player.turn_off
  - alias: Choose Playlist
    trigger:
      - platform: state
        entity_id: input_select.radio_station
    action:
      - service: shell_command.input_radio_clementine
      #- service: media_player.select_source
        #data_template:
          #entity_id: media_player.clementine
          #source: '{{ states.input_select.radio_station.state }}'
        #{% if is_state("input_select.radio_station", "RFI") %}
        #http://www.radio-browser.info/webservice/v2/m3u/url/29859
        #{%-elif is_state("input_select.radio_station", "France Culture") %}
        #http://www.radio-browser.info/webservice/v2/m3u/url/45416
        #{% else %}
        #none
        #{% endif %}

shell_command:
  blink: 'delcom-control --blink'
  radio_rfi: 'clementine-radio-browser "RFI Monde"'
  input_radio_clementine: 'clementine-radio-browser "{{ states.input_select.radio_station.state }}"'
  #input_radio_clementine: 'clementine --play http://www.radio-browser.info/webservice/m3u/stations/bynameexact/"{{ states.input_select.radio_station.state }}"'

script:
  restart_ha:
    alias: Restart HomeAssistant
    sequence:
      - alias: Restart HA
        service: homeassistant.restart
  reload_automations:
    alias: Reload Automations
    sequence:
      - alias: Reload-Automations
        service: automation.reload

# https://home-assistant.io/docs/mqtt/logging/
logger:
  default: info
  logs:
    homeassistant.components.mqtt: debug
