homeassistant:
  name: kooka
  unit_system: metric
  time_zone: Europe/Paris
  latitude: 48.839548
  longitude: 2.395671
  elevation: 36

history: # Enables support for tracking state changes over time.
updater: # Checks for available updates
logbook: # View all events in a logbook
config: # Enables configuration UI
frontend: # Enables the frontend

mqtt:
  username: skldhf84d
  password: !secret mqtt
  client_id: kooka
  broker: stuartpi3

http:
  api_password: !secret http
  #server_host: 127.0.0.1
  trusted_networks:
    - 127.0.0.1

media_player:
  - platform: spotify
    client_id: !secret spotify_client
    client_secret: !secret spotify_secret
  - platform: mpd
    host: 192.168.0.8
    password: !secret mpd_passwd

#mqtt_eventstream:
#  publish_topic: master/kooka
#  subscribe_topic: slaves/bedroom

mqtt_statestream:
  base_topic: salon

# https://home-assistant.io/cookbook/perform_actions_based_on_input_select/
input_select:
  radio_station:
    name: Radio Station
    options:
      - RFI Monde
      - France Culture
      - ABC Radio National MP3
      - France Info
      - Ch√©rie FM
      - BBC World Service (AAC)
      - Public Radio International PRI 24 Hour Stream
      - Radio Tram
      - Radio 9090 90.9
      - Nogoum FM 100.6
      - 181.FM - Vocal Jazz
      - '#1 Jazz Radio'
      - '.977 Smooth Jazz'
      - None
    initial: None
    icon: mdi:radio

automation:
  - alias: Stop Spotify on mpd Start
    trigger: # https://home-assistant.io/docs/automation/trigger/
      - platform: state
        entity_id: media_player.mpd
        to: 'playing'
    action:
      - service: media_player.media_pause
        data:
          entity_id: media_player.spotify
  - alias: Stop MPD on Media Start
    trigger: # https://home-assistant.io/docs/automation/trigger/
      - platform: state
        entity_id: media_player.spotify
        to: 'playing'
    action:
      - service: media_player.media_pause
        data:
          entity_id: media_player.mpd
  - alias: radio mqtt message
    trigger:
      - platform: mqtt
        topic: 'radio'
    action: # https://community.home-assistant.io/t/passing-variables-from-mqtt-trigger-payload-to-shell-script/23047/4
      - service: shell_command.radio_info
        data_template:
          value: '{{ trigger.payload }}'
  - alias: Play Democracy Now
    trigger:
      - platform: mqtt
        topic: 'message'
        payload: 'democracynow'
    action:
      - service: shell_command.democracynow
  - alias: Play Podcast
    trigger:
      - platform: mqtt
        topic: 'message'
        payload: 'playnewestpod'
    action:
      - service: shell_command.playnewestpod
  - alias: message_leaving
    trigger:
      - platform: mqtt
        topic: 'message'
        payload: 'leaving'
    action:
      - service: media_player.media_pause
        data:
          entity_id: media_player.spotify
      - service: media_player.media_pause
        data:
          entity_id: media_player.mpd
  - alias: Amps Off
    trigger:
      - platform: mqtt
        topic: 'message'
        payload: 'amps off'
    action:
      - service: media_player.media_pause
        data:
          entity_id: media_player.spotify
      - service: media_player.media_pause
        data:
          entity_id: media_player.mpd
  - alias: bedroom clock
    trigger:
      - platform: event
        event_type: bedroom.switch.delcom_clock.state
    action:
      service: media_player.turn_off
  - alias: Choose From Radio List
    trigger:
      - platform: state
        entity_id: input_select.radio_station
    action:
      - service: shell_command.radio_info
        data_template:
          value: '{{ states.input_select.radio_station.state }}'

shell_command:
  radio_info: 'radioinfo_mpd.py "{{ value }}"'
  playnewestpod: 'playnewestpod'
  democracynow: 'playnewestpod http://www.democracynow.org/podcast.xml'

#script:
#  restart_ha:
#    alias: Restart HomeAssistant
#    sequence:
#      - alias: Restart HA
#        service: homeassistant.restart
#  reload_automations:
#    alias: Reload Automations
#    sequence:
#      - alias: Reload-Automations
#        service: automation.reload

# https://home-assistant.io/docs/mqtt/logging/
logger:
  default: warn
  logs:
    homeassistant.components.mqtt: warn
